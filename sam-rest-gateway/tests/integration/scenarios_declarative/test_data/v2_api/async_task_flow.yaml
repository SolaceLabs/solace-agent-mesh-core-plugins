test_case_id: "v2_async_task_flow"
description: "V2 API async task submission and polling test"
tags: ["rest_gateway", "v2"]

enable_polling: true
max_polling_attempts: 5
polling_interval_seconds: 0.3

llm_interactions:
  - static_response:
      choices:
        - message:
            role: "assistant"
            content: "This is an async response from the test agent."
          finish_reason: "stop"

gateway_input:
  endpoint: "/api/v2/tasks"
  method: "POST"
  auth_token: "valid"
  form_data:
    agent_name: "TestAgent"
    prompt: "Process this async request"

expected_gateway_output:
  - status_code: 202
    response_contains:
      taskId: null  # We expect a taskId but don't care about the exact value
  - status_code: 200
    response_json_matches:
      status:
        state: "completed"
    response_contains:
      "This is an async response from the test agent."
